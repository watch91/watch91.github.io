<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汉字加密解密工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .mode-select {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 20px;
        }
        
        .mode-btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #e9ecef;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background-color: #007bff;
            color: white;
        }
        
        .input-area, .output-area {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            min-height: 120px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .btn-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .action-btn {
            padding: 12px 30px;
            font-size: 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .action-btn:hover {
            background-color: #218838;
        }
        
        .reset-btn {
            padding: 12px 30px;
            font-size: 16px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 10px;
        }
        
        .reset-btn:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>汉字加密解密工具</h1>
        
        <!-- 模式选择 -->
        <div class="mode-select">
            <button class="mode-btn active" id="encrypt-mode">加密模式</button>
            <button class="mode-btn" id="decrypt-mode">解密模式</button>
        </div>
        
        <!-- 输入区域 -->
        <div class="input-area">
            <label for="input-text">请输入文本：</label>
            <textarea id="input-text" placeholder="在此输入需要加密/解密的汉字文本..."></textarea>
        </div>
        
        <!-- 操作按钮 -->
        <div class="btn-container">
            <button class="action-btn" id="process-btn">开始加密</button>
            <button class="reset-btn" id="reset-btn">清空内容</button>
        </div>
        
        <!-- 输出区域 -->
        <div class="output-area">
            <label for="output-text">结果：</label>
            <textarea id="output-text" readonly placeholder="加密/解密结果将显示在这里..."></textarea>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const encryptModeBtn = document.getElementById('encrypt-mode');
        const decryptModeBtn = document.getElementById('decrypt-mode');
        const processBtn = document.getElementById('process-btn');
        const resetBtn = document.getElementById('reset-btn');
        const inputText = document.getElementById('input-text');
        const outputText = document.getElementById('output-text');
        
        // 当前模式：encrypt 加密，decrypt 解密
        let currentMode = 'encrypt';
        // 验证码标识
        const prefixCode = '哈吉米';
        const suffixCode = '南北绿豆';
        // 数字转字母映射表（1-q,2-w,3-e,4-r,5-t,6-y,7-u,8-i,9-o）
        const numToLetterMap = {
            '1': 'q', '2': 'w', '3': 'e', 
            '4': 'r', '5': 't', '6': 'y', 
            '7': 'u', '8': 'i', '9': 'o', '0': '0' // 0保持不变
        };
        // 字母转数字反向映射表
        const letterToNumMap = Object.fromEntries(
            Object.entries(numToLetterMap).map(([k, v]) => [v, k])
        );

        // 模式切换
        encryptModeBtn.addEventListener('click', () => {
            currentMode = 'encrypt';
            encryptModeBtn.classList.add('active');
            decryptModeBtn.classList.remove('active');
            processBtn.textContent = '开始加密';
            inputText.placeholder = '在此输入需要加密的汉字文本...';
        });
        
        decryptModeBtn.addEventListener('click', () => {
            currentMode = 'decrypt';
            decryptModeBtn.classList.add('active');
            encryptModeBtn.classList.remove('active');
            processBtn.textContent = '开始解密';
            inputText.placeholder = '在此输入需要解密的文本...';
        });

        // 生成30~135之间的随机偏移量
        function getRandomOffset() {
            return Math.floor(Math.random() * (135 - 30 + 1)) + 30;
        }

        // 数字转字母（按规则）
        function numToLetter(num) {
            return num.toString().split('').map(digit => {
                return numToLetterMap[digit] || digit; // 非1-9的数字保持原样
            }).join('');
        }

        // 字母转数字（按规则）
        function letterToNum(letterStr) {
            const numStr = letterStr.split('').map(letter => {
                return letterToNumMap[letter] || letter; // 非映射字母保持原样
            }).join('');
            // 转换为数字并验证范围
            const num = parseInt(numStr);
            return isNaN(num) || num < 30 || num > 135 ? null : num;
        }

        // 加密核心函数：随机偏移量 + 验证码 + 偏移量字母后缀
        function encryptChinese(text) {
            // 1. 生成随机偏移量（30~135）
            const offset = getRandomOffset();
            // 2. 执行汉字编码偏移
            let encryptedText = '';
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const charCode = char.charCodeAt(0);
                // 仅对汉字进行偏移（Unicode：0x4E00 - 0x9FFF）
                if (charCode >= 0x4E00 && charCode <= 0x9FFF) {
                    encryptedText += String.fromCharCode(charCode + offset);
                } else {
                    encryptedText += char;
                }
            }
            // 3. 添加验证码前缀后缀
            const textWithCode = prefixCode + encryptedText + suffixCode;
            // 4. 偏移量转字母并追加到末尾
            const offsetLetter = numToLetter(offset);
            return textWithCode + offsetLetter;
        }

        // 解密核心函数：提取偏移量 → 验证验证码 → 解密文本
        function decryptChinese(text) {
            // 1. 校验文本非空
            if (!text) {
                return { success: false, message: '请输入有效的解密文本！' };
            }

            // 2. 提取末尾的偏移量字母（偏移量是2-3位：30~135 → 2位或3位）
            let offset = null;
            let pureText = '';
            // 先尝试3位（100~135）
            const letter3 = text.slice(-3);
            offset = letterToNum(letter3);
            if (offset !== null) {
                pureText = text.slice(0, -3);
            } else {
                // 再尝试2位（30~99）
                const letter2 = text.slice(-2);
                offset = letterToNum(letter2);
                if (offset !== null) {
                    pureText = text.slice(0, -2);
                } else {
                    return { success: false, message: '解密失败！无法识别有效的偏移量标识。' };
                }
            }

            // 3. 验证验证码
            if (!pureText.startsWith(prefixCode) || !pureText.endsWith(suffixCode)) {
                return { success: false, message: '验证失败！文本缺少有效验证码标识，无法解密。' };
            }

            // 4. 移除验证码前缀后缀
            const textWithoutCode = pureText.slice(prefixCode.length, -suffixCode.length);

            // 5. 执行解密逻辑
            let decryptedText = '';
            for (let i = 0; i < textWithoutCode.length; i++) {
                const char = textWithoutCode[i];
                const charCode = char.charCodeAt(0);
                // 仅对加密后的汉字进行还原
                if (charCode >= (0x4E00 + offset) && charCode <= (0x9FFF + offset)) {
                    decryptedText += String.fromCharCode(charCode - offset);
                } else {
                    decryptedText += char;
                }
            }

            return { success: true, data: decryptedText };
        }
        
        // 处理加密/解密操作
        processBtn.addEventListener('click', () => {
            const text = inputText.value.trim();
            if (!text) {
                window.alert('请输入需要处理的文本！');
                outputText.value = '';
                return;
            }
            
            if (currentMode === 'encrypt') {
                // 加密逻辑
                const encryptResult = encryptChinese(text);
                outputText.value = encryptResult;
            } else {
                // 解密逻辑
                const decryptResult = decryptChinese(text);
                outputText.value = ''; // 先清空输出框
                if (!decryptResult.success) {
                    window.alert(decryptResult.message);
                    return;
                }
                // 验证成功，显示解密结果
                outputText.value = decryptResult.data;
            }
        });
        
        // 清空内容
        resetBtn.addEventListener('click', () => {
            inputText.value = '';
            outputText.value = '';
        });
        
        // 支持回车触发处理
        inputText.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                processBtn.click();
            }
        });
    </script>
</body>
</html>
